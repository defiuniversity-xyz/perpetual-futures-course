<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Risk Assessment Checklist - DeFi University</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDuGdDF6jYPcZbQTpbGZPwnl3Qynr-LMWc",
            authDomain: "defi-university-prod.firebaseapp.com",
            projectId: "defi-university-prod",
            storageBucket: "defi-university-prod.firebasestorage.app",
            messagingSenderId: "309871336262",
            appId: "1:309871336262:web:d2dc4be5729ac1d5a6a347"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        let userToken = null;
        let tracked = false;

        onAuthStateChanged(auth, async (user) => {
            if (user) userToken = await user.getIdToken();
        });

        const itemLabels = {
            'funding-checked': 'Check funding rate',
            'liquidation-calculated': 'Calculate liquidation price',
            'safety-buffer': 'Maintain safety buffer',
            'leverage-appropriate': 'Use appropriate leverage',
            'isolated-margin': 'Use isolated margin',
            'stop-loss-set': 'Set stop loss',
            'position-size': 'Appropriate position size',
            'max-loss-acceptable': 'Acceptable max loss',
            'breakeven-calculated': 'Calculate break-even',
            'oi-checked': 'Check Open Interest',
            'not-emotional': 'Not trading on emotion',
            'exit-plan': 'Clear exit plan'
        };

        let checkedItems = new Set();
        const totalItems = 12;

        window.toggleItem = async function(el) {
            const item = el.dataset.item;
            
            if (el.classList.contains('checked')) {
                el.classList.remove('checked');
                checkedItems.delete(item);
            } else {
                el.classList.add('checked');
                checkedItems.add(item);
            }

            updateProgress();
            
            if (checkedItems.size === totalItems && !tracked && userToken) {
                tracked = true;
                try {
                    const response = await fetch('https://api.defiuniversity.xyz/api/progress/interaction', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${userToken}` },
                        body: JSON.stringify({ courseId: 'perpetual-futures', interactionId: 'risk-assessment-checklist', type: 'checklist' })
                    });
                    if (response.ok) {
                        const badge = document.getElementById('points-badge');
                        badge.classList.add('show');
                        setTimeout(() => badge.classList.remove('show'), 2500);
                    }
                } catch (e) { console.error('Tracking error:', e); }
            }
        };

        function updateProgress() {
            const count = checkedItems.size;
            const percentage = (count / totalItems) * 100;
            
            document.getElementById('progress-fill').style.width = `${percentage}%`;
            document.getElementById('progress-score').textContent = count;

            const resultsSection = document.getElementById('results-section');
            const resultIcon = document.getElementById('result-icon');
            const resultTitle = document.getElementById('result-title');
            const resultDesc = document.getElementById('result-desc');
            const missingItems = document.getElementById('missing-items');
            const missingList = document.getElementById('missing-list');

            if (count >= 10) {
                resultsSection.classList.remove('hidden');
                
                if (count === totalItems) {
                    resultIcon.textContent = 'üéâ';
                    resultTitle.textContent = 'Ready to Trade!';
                    resultTitle.className = 'text-xl font-semibold text-green-600 mb-2 brand-font';
                    resultDesc.textContent = "You've completed all risk checks. You're prepared to open this position safely.";
                    resultDesc.className = 'text-neutral-600 text-sm leading-relaxed';
                    missingItems.classList.add('hidden');
                } else {
                    resultIcon.textContent = '‚ö†Ô∏è';
                    resultTitle.textContent = 'Almost Ready';
                    resultTitle.className = 'text-xl font-semibold text-orange-600 mb-2 brand-font';
                    resultDesc.textContent = 'Complete the remaining checks before opening your position.';
                    resultDesc.className = 'text-neutral-600 text-sm leading-relaxed';
                    
                    const missing = Object.keys(itemLabels).filter(item => !checkedItems.has(item));
                    missingList.innerHTML = missing.map(item => `<li>${itemLabels[item]}</li>`).join('');
                    missingItems.classList.remove('hidden');
                }
            } else if (count >= 6) {
                resultsSection.classList.remove('hidden');
                resultIcon.textContent = 'üî∂';
                resultTitle.textContent = 'Making Progress';
                resultTitle.className = 'text-xl font-semibold text-blue-600 mb-2 brand-font';
                resultDesc.textContent = `Complete ${totalItems - count} more checks to be ready to trade.`;
                resultDesc.className = 'text-neutral-600 text-sm leading-relaxed';
                missingItems.classList.add('hidden');
            } else {
                resultsSection.classList.add('hidden');
            }
        }
    </script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff;
        }
        h1, h2, h3, h4, .brand-font {
            font-family: 'Space Grotesk', sans-serif;
        }
        
        .checklist-item {
            transition: all 0.2s;
        }
        .checklist-item:hover { 
            background-color: rgba(0, 0, 0, 0.02);
        }
        .checklist-item.checked { 
            border-color: #22c55e; 
            background-color: rgba(34, 197, 94, 0.05);
        }
        .checkbox {
            transition: all 0.2s;
        }
        .checklist-item.checked .checkbox { 
            background: #22c55e; 
            border-color: #22c55e;
        }
        
        #points-badge {
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }
        #points-badge.show { 
            opacity: 1; 
            transform: translateY(0); 
        }
    </style>
</head>
<body class="bg-white text-neutral-900 min-h-screen p-4 md:p-8">
    <div class="max-w-2xl mx-auto relative">
        <div id="points-badge" class="absolute top-0 right-0 bg-blue-50 border border-blue-200 text-blue-600 px-4 py-2 rounded-full text-sm font-semibold">
            +15 pts earned!
        </div>
        
        <!-- Header -->
        <div class="text-center mb-8 bg-white border border-neutral-200 rounded-xl p-6 shadow-sm">
            <h1 class="text-2xl font-semibold text-neutral-900 brand-font mb-2">‚úÖ Pre-Trade Risk Assessment</h1>
            <p class="text-neutral-500 text-sm">Complete this checklist before opening any perpetual position</p>
        </div>
        
        <!-- Progress Section -->
        <div class="bg-white border border-neutral-200 rounded-xl p-6 mb-6 shadow-sm">
            <div class="w-full h-3 bg-neutral-200 rounded-full overflow-hidden mb-3">
                <div class="h-full bg-gradient-to-r from-red-500 via-yellow-500 to-green-500 rounded-full transition-all" id="progress-fill" style="width: 0%"></div>
            </div>
            <div class="text-center">
                <span class="text-2xl font-bold text-blue-600" id="progress-score">0</span> / <span class="text-neutral-600" id="total-items">12</span> checks completed
            </div>
        </div>
        
        <!-- Checklist Sections -->
        <div class="space-y-4">
            <div class="bg-white border border-neutral-200 rounded-xl p-6 shadow-sm">
                <div class="text-lg font-semibold text-neutral-900 brand-font mb-4 flex items-center gap-2">üìä Position Analysis</div>
                <div class="space-y-3">
                    <div class="checklist-item flex items-start gap-3 p-4 rounded-lg border-2 border-transparent cursor-pointer bg-white hover:bg-neutral-50" onclick="toggleItem(this)" data-item="funding-checked">
                        <div class="checkbox w-6 h-6 border-2 border-neutral-300 rounded flex items-center justify-center flex-shrink-0">
                            <svg class="hidden w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                        </div>
                        <div class="flex-1">
                            <div class="font-medium text-neutral-900 mb-1">Checked current funding rate</div>
                            <div class="text-xs text-neutral-500">Verified annualized rate is acceptable (<50% APR) for my holding period</div>
                        </div>
                    </div>
                    <div class="checklist-item flex items-start gap-3 p-4 rounded-lg border-2 border-transparent cursor-pointer bg-white hover:bg-neutral-50" onclick="toggleItem(this)" data-item="liquidation-calculated">
                        <div class="checkbox w-6 h-6 border-2 border-neutral-300 rounded flex items-center justify-center flex-shrink-0">
                            <svg class="hidden w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                        </div>
                        <div class="flex-1">
                            <div class="font-medium text-neutral-900 mb-1">Calculated liquidation price</div>
                            <div class="text-xs text-neutral-500">Used calculator to determine exact liquidation price for my leverage</div>
                        </div>
                    </div>
                    <div class="checklist-item flex items-start gap-3 p-4 rounded-lg border-2 border-transparent cursor-pointer bg-white hover:bg-neutral-50" onclick="toggleItem(this)" data-item="safety-buffer">
                        <div class="checkbox w-6 h-6 border-2 border-neutral-300 rounded flex items-center justify-center flex-shrink-0">
                            <svg class="hidden w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                        </div>
                        <div class="flex-1">
                            <div class="font-medium text-neutral-900 mb-1">Maintained 20-30% safety buffer</div>
                            <div class="text-xs text-neutral-500">Current price has sufficient buffer above/below liquidation price</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="bg-white border border-neutral-200 rounded-xl p-6 shadow-sm">
                <div class="text-lg font-semibold text-neutral-900 brand-font mb-4 flex items-center gap-2">‚öôÔ∏è Position Settings</div>
                <div class="space-y-3">
                    <div class="checklist-item flex items-start gap-3 p-4 rounded-lg border-2 border-transparent cursor-pointer bg-white hover:bg-neutral-50" onclick="toggleItem(this)" data-item="leverage-appropriate">
                        <div class="checkbox w-6 h-6 border-2 border-neutral-300 rounded flex items-center justify-center flex-shrink-0">
                            <svg class="hidden w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                        </div>
                        <div class="flex-1">
                            <div class="font-medium text-neutral-900 mb-1">Leverage is appropriate</div>
                            <div class="text-xs text-neutral-500">Using conservative leverage (3x-5x for beginners, max 10x for experienced)</div>
                        </div>
                    </div>
                    <div class="checklist-item flex items-start gap-3 p-4 rounded-lg border-2 border-transparent cursor-pointer bg-white hover:bg-neutral-50" onclick="toggleItem(this)" data-item="isolated-margin">
                        <div class="checkbox w-6 h-6 border-2 border-neutral-300 rounded flex items-center justify-center flex-shrink-0">
                            <svg class="hidden w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                        </div>
                        <div class="flex-1">
                            <div class="font-medium text-neutral-900 mb-1">Using isolated margin mode</div>
                            <div class="text-xs text-neutral-500">Position risk is isolated to only this trade, not my entire account</div>
                        </div>
                    </div>
                    <div class="checklist-item flex items-start gap-3 p-4 rounded-lg border-2 border-transparent cursor-pointer bg-white hover:bg-neutral-50" onclick="toggleItem(this)" data-item="stop-loss-set">
                        <div class="checkbox w-6 h-6 border-2 border-neutral-300 rounded flex items-center justify-center flex-shrink-0">
                            <svg class="hidden w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                        </div>
                        <div class="flex-1">
                            <div class="font-medium text-neutral-900 mb-1">Stop loss order is set</div>
                            <div class="text-xs text-neutral-500">Have a stop loss order ready to limit maximum loss</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="bg-white border border-neutral-200 rounded-xl p-6 shadow-sm">
                <div class="text-lg font-semibold text-neutral-900 brand-font mb-4 flex items-center gap-2">üí∞ Risk Management</div>
                <div class="space-y-3">
                    <div class="checklist-item flex items-start gap-3 p-4 rounded-lg border-2 border-transparent cursor-pointer bg-white hover:bg-neutral-50" onclick="toggleItem(this)" data-item="position-size">
                        <div class="checkbox w-6 h-6 border-2 border-neutral-300 rounded flex items-center justify-center flex-shrink-0">
                            <svg class="hidden w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                        </div>
                        <div class="flex-1">
                            <div class="font-medium text-neutral-900 mb-1">Position size is 1-5% of capital</div>
                            <div class="text-xs text-neutral-500">Not risking more than 5% of my total trading capital on this single trade</div>
                        </div>
                    </div>
                    <div class="checklist-item flex items-start gap-3 p-4 rounded-lg border-2 border-transparent cursor-pointer bg-white hover:bg-neutral-50" onclick="toggleItem(this)" data-item="max-loss-acceptable">
                        <div class="checkbox w-6 h-6 border-2 border-neutral-300 rounded flex items-center justify-center flex-shrink-0">
                            <svg class="hidden w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                        </div>
                        <div class="flex-1">
                            <div class="font-medium text-neutral-900 mb-1">Maximum loss is acceptable</div>
                            <div class="text-xs text-neutral-500">Calculated worst-case scenario loss and it won't affect my financial situation</div>
                        </div>
                    </div>
                    <div class="checklist-item flex items-start gap-3 p-4 rounded-lg border-2 border-transparent cursor-pointer bg-white hover:bg-neutral-50" onclick="toggleItem(this)" data-item="breakeven-calculated">
                        <div class="checkbox w-6 h-6 border-2 border-neutral-300 rounded flex items-center justify-center flex-shrink-0">
                            <svg class="hidden w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                        </div>
                        <div class="flex-1">
                            <div class="font-medium text-neutral-900 mb-1">Break-even price move calculated</div>
                            <div class="text-xs text-neutral-500">Know the minimum price move needed to cover fees and funding costs</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="bg-white border border-neutral-200 rounded-xl p-6 shadow-sm">
                <div class="text-lg font-semibold text-neutral-900 brand-font mb-4 flex items-center gap-2">üîç Pre-Trade Validation</div>
                <div class="space-y-3">
                    <div class="checklist-item flex items-start gap-3 p-4 rounded-lg border-2 border-transparent cursor-pointer bg-white hover:bg-neutral-50" onclick="toggleItem(this)" data-item="oi-checked">
                        <div class="checkbox w-6 h-6 border-2 border-neutral-300 rounded flex items-center justify-center flex-shrink-0">
                            <svg class="hidden w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                        </div>
                        <div class="flex-1">
                            <div class="font-medium text-neutral-900 mb-1">Checked Open Interest</div>
                            <div class="text-xs text-neutral-500">Market has healthy OI (not a crowded trade or illiquid market)</div>
                        </div>
                    </div>
                    <div class="checklist-item flex items-start gap-3 p-4 rounded-lg border-2 border-transparent cursor-pointer bg-white hover:bg-neutral-50" onclick="toggleItem(this)" data-item="not-emotional">
                        <div class="checkbox w-6 h-6 border-2 border-neutral-300 rounded flex items-center justify-center flex-shrink-0">
                            <svg class="hidden w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                        </div>
                        <div class="flex-1">
                            <div class="font-medium text-neutral-900 mb-1">Not trading on emotion</div>
                            <div class="text-xs text-neutral-500">This trade is based on analysis, not FOMO, fear, or revenge trading</div>
                        </div>
                    </div>
                    <div class="checklist-item flex items-start gap-3 p-4 rounded-lg border-2 border-transparent cursor-pointer bg-white hover:bg-neutral-50" onclick="toggleItem(this)" data-item="exit-plan">
                        <div class="checkbox w-6 h-6 border-2 border-neutral-300 rounded flex items-center justify-center flex-shrink-0">
                            <svg class="hidden w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                        </div>
                        <div class="flex-1">
                            <div class="font-medium text-neutral-900 mb-1">Have a clear exit plan</div>
                            <div class="text-xs text-neutral-500">Know exactly when I will close this position (target price, time, or stop loss)</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Results Section -->
        <div id="results-section" class="hidden mt-6 bg-white border border-neutral-200 rounded-xl p-8 text-center shadow-sm">
            <div class="text-5xl mb-4" id="result-icon">üéâ</div>
            <div class="text-xl font-semibold text-green-600 mb-2 brand-font" id="result-title">Ready to Trade!</div>
            <div class="text-neutral-600 text-sm leading-relaxed mb-4" id="result-desc">You've completed all risk checks. You're prepared to open this position safely.</div>
            <div class="hidden mt-5 p-4 bg-red-50 border border-red-200 rounded-lg text-left" id="missing-items">
                <div class="text-sm font-semibold text-red-600 mb-2">‚ö†Ô∏è Missing Items:</div>
                <ul class="text-sm text-red-800 space-y-1 list-disc list-inside" id="missing-list"></ul>
            </div>
        </div>
    </div>
    
    <script>
        // Update checkbox display when toggled
        document.querySelectorAll('.checklist-item').forEach(item => {
            item.addEventListener('click', function() {
                const checkbox = this.querySelector('.checkbox');
                const svg = checkbox.querySelector('svg');
                if (this.classList.contains('checked')) {
                    svg.classList.remove('hidden');
                } else {
                    svg.classList.add('hidden');
                }
            });
        });
    </script>
</body>
</html>
